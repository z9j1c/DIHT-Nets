## Виртуальные сети

Используются для сокрытия топологии от участников сети.

### VLAN

Технология, позволяющая разбивать физические, L2 сети на логические. (Не ip-сети, сейчас broadcast для нас - специальный mac-адрес)
Физические разделение дорого, а отделить одну часть сети от другой иногда нужно. Свич создаёт "виртуальный свич", обслуживающий только одну виртуальную сеть (см. слайд 'сеть с vlan').

#### Access Link

Access Link - порт, который свич настраивает так, что он обслуживает одну vlan. При этом трафик на этом порту не имеет тегов (часть пакета ethernet, о которой позже).

#### Trunk Link

А если в сети множество физических свичей. Как передавать инфу между разными физ. свичами, который относится к разным vlan'ам.

Через Trunk Link может идти трафик из любой vlan (можно настроить, трафик каких vlan'ов пропускает данный порт с поднятым trunk link'ом).

#### Tagged VLAN

Вспоминаем про теги из протокола ethernet. Имеем 12 бит тега, в которые можно записать vlan id.

#### InterSwich Link

Протокол 2 уровня для взаимодействия между свичами. В заголовке ISL есть поле VLAN (15 бит, в 8 раз больше, чем может "адресовать" ethernet). Выставленный бит BPDU - пакет сможет проходить через BLK порт (вспоминаем STP).

#### Routing между VLAN'ами

Нужно поставить ещё один роутер, который связан с каждым VLAN'ом.

- Можно AccessLink'ами к каждой VLAN. 
- Можно "Router on the stick": на отдельный роутер кидается TrunkLink
- Участник сети с двумя сетевыми картами может быть одновременно в двух VLAN'ах. Это плохо масштабируется и вообще кустарненько.
- L3 Switch InterVLAN: ставится свич, который может в ip-адреса. Это уже хорошее корпоративное решение.


#### Q-in-Q

Хотим vlan запаковать в vlan.

#### Туннелирование из L2 в L3

Отправляются ip-пакеты, а в них ethernet-пакеты. 

- VNI - VxLAN Network Identifier (VLAN ID для VxLAN, 24 bit)
- VTEP - VxLAN Tunnel Endpoint - устройство, обеспечивающее инкапусляцию L2 трафика. Всё работает поверх UDP:
    * Software (host-based) - чаще всего части гипервизоров
    * Hardware - между маршрутизаторами развёртывается Underlay Network

CISCO с VxLAN не работает. Увы(

#### VPN

Похож на VxLAN (вообще это частный случай VPN). VPN шифруется.